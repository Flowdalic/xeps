<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE xep SYSTEM 'xep.dtd' [
  <!ENTITY % ents SYSTEM 'xep.ent'>
%ents;
]>
<?xml-stylesheet type='text/xsl' href='xep.xsl'?>
<xep>
<header>
  <title>OpenPGP for XMPP</title>
  <abstract>Secifies end-to-end encryption for data with the help of
  OpenPGP, annoucement, discovery and retrieval of public keys and a
  mechanism to syncrhonize private keys over multiple
  devices.</abstract>
  <legal>
    <copyright>This XMPP Extension Protocol is copyright (c) 1999 - 2014 by the XMPP Standards Foundation (XSF).</copyright>
    <permissions>Permission is hereby granted, free of charge, to any person obtaining a copy of this specification (the &quot;Specification&quot;), to make use of the Specification without restriction, including without limitation the rights to implement the Specification in a software program, deploy the Specification in a network service, and copy, modify, merge, publish, translate, distribute, sublicense, or sell copies of the Specification, and to permit persons to whom the Specification is furnished to do so, subject to the condition that the foregoing copyright notice and this permission notice shall be included in all copies or substantial portions of the Specification. Unless separate permission is granted, modified works that are redistributed shall not contain misleading information regarding the authors, title, number, or publisher of the Specification, and shall not claim endorsement of the modified works by the authors, any organization or project to which the authors belong, or the XMPP Standards Foundation.</permissions>
    <warranty>## NOTE WELL: This Specification is provided on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or implied, including, without limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE. In no event shall the XMPP Standards Foundation or the authors of this Specification be liable for any claim, damages, or other liability, whether in an action of contract, tort, or otherwise, arising from, out of, or in connection with the Specification or the implementation, deployment, or other use of the Specification. ##</warranty>
    <liability>In no event and under no legal theory, whether in tort (including negligence), contract, or otherwise, unless required by applicable law (such as deliberate and grossly negligent acts) or agreed to in writing, shall the XMPP Standards Foundation or any author of this Specification be liable for damages, including any direct, indirect, special, incidental, or consequential damages of any character arising out of the use or inability to use the Specification (including but not limited to damages for loss of goodwill, work stoppage, computer failure or malfunction, or any and all other commercial damages or losses), even if the XMPP Standards Foundation or such author has been advised of the possibility of such damages.</liability>
    <conformance>This XMPP Extension Protocol has been contributed in full conformance with the XSF's Intellectual Property Rights Policy (a copy of which may be found at &lt;<link url='http://xmpp.org/extensions/ipr-policy.shtml'>http://xmpp.org/extensions/ipr-policy.shtml</link>&gt; or obtained by writing to XSF, P.O. Box 1641, Denver, CO 80201 USA).</conformance>
  </legal>
  <number>xxxx</number>
  <status>ProtoXEP</status>
  <type>Standards Track</type>
  <sig>Standards</sig>
  <approver>Council</approver>
  <dependencies>
    <spec>XMPP Core</spec>
    <spec>TODO PEP</spec>
    <spec>TODO Private Data Storage</spec>
	<spec>TODO Disco?</spec>
  </dependencies>
  <supersedes/>
  <supersededby/>
  <shortname>opgp</shortname>
  <author>
    <firstname>Florian</firstname>
    <surname>Schmaus</surname>
    <email>flo@geekplace.eu</email>
    <jid>flo@geekplace.eu</jid>
  </author>
  <author>
    <firstname>Dominik</firstname>
    <surname>Sch√ºrman</surname>
    <email>TODO</email>
    <jid>TODO</jid>
  </author>
  <author>
    <firstname>Vincent</firstname>
    <surname>Breitmoser</surname>
    <email>TODO</email>
    <jid>TOOD</jid>
  </author>
  <revision>
    <version>0.0.1alpha1</version>
    <date>2016-11-16</date>
    <initials>fs</initials>
    <remark><p>First draft.</p></remark>
  </revision>
</header>
<section1 topic='Introduction' anchor='intro'>
  <p>This XMPP extension protocol specifies end-to-end encryption for
  data with the help of OpenPGP.</p>
  <p>Furthermore XMPP provides the mechanisms to solve a lot of issues
  that come with modern day OpenPGP usage. PEP provides a standardizes
  way to discovery OpenPGP public keys of other entities while, unlike
  the OpenPGP keyserver, establishing a strong relation between the
  key and the user, and Private Data Storage allows for easy OpenPGP
  key synchronization accross devices (of the same XMPP
  entity). OpenPGP in return allows for end-to-end encrypted data to
  be exchanged between one, two or even multiple entities.</p>
  <p>This XEP is an alternative to similar XEPs, e.g. OMEMO, providing
  (TODO emph) no Perfect Forward Secrecy but thus, as advantage,
  allowing users to rhead their archived converstaions, or, in gernal,
  their encrypted data, later on (as long as they still posses the
  according private key).</p>
</section1>
<section1 topic='Requirements' anchor='reqs'>
  <p>STRONGLY RECOMMENDED.</p>
</section1>
<section1 topic='Glossary' anchor='glossary'>
  <p>OPTIONAL.</p>
</section1>
<section1 topic='Use Cases' anchor='usecases'>
  <p>STRONGLY RECOMMENDED.</p>
  <section2 topic='Discovering Support' anchor='disco'>
  </section2>
  <section2 topic='Announcing the public key via PEP' anchor='annoucing-pubkey'>
	<example caption='Saving the public key in the PEP node.'><![CDATA[
<iq from='juliet@example.org/balcony' type='set' id='1'>
  <pubsub>
     <publish node='urn:xmpp:openpgp:0'>
        <item>
          <pubkeys xmlns='urn:xmpp:openpgp:0'>
            <pubkey>
              <!-- BASE64_PUBLIC_KEY -->
              YWJjMTIzIT8kK...
            </pubkey>
          </pubkeys>
         </item>
      </publish>
    </pubsub>
</iq>]]></example>
	<example caption='Requesting a OpenPGP public key from a XMPP entity.'><![CDATA[
<iq from='romeo@example.org/orchard' to='juliet@example.org' type='get' id='2'>
  <pubsub>
    <items node='urn:xmpp:openpgp:0'/>
   </pubsub>
</iq>]]></example>
	<example caption='PEP result containing the requested public key.'><![CDATA[
<iq from='juliet@example.org' to='romeo@example.org/orchard' type='result' id='2'>
  <pubsub>
    <publish node='urn:xmpp:openpgp:0'>
      <item>
        <pubkeys xmlns='urn:xmpp:openpgp:0'>
          <pubkey>
            <!-- BASE64_PUBLIC_KEY -->
            YWJjMTIzIT8kK...
          </pubkey>
        </pubkeys>
      </item>
    </publish>
  </pubsub>
</iq>]]></example>
  <p>Note that the result may contain multiple pubkeys elements. Only
  the public keys found in the most recent MUST be used. Requestors
  may want to limit the results to the most recent item using the
  'max_items' attribute (Note: RSM would be an alternative but XEP-60
  says it is not yet mandatory).</p>
  </section2>
  <section2 topic='Encrypted and signed data' anchor='signcrypt'>
	<example caption='The openpgp extension within a message.'><![CDATA[
<message to='user@example.org'>
  <openpgp xmlns='urn:xmpp:openpgp:0'>
    <!-- BASE64_OPENPGP_BLOB -->
    WdC81xuET8kAK...
  </openpgp>
</message>]]></example>
	<p>BASE64_OPENPGP_BLOB is an UTF-8 encoded string which is
	encrypted and signed using OpenPGP and then encoded with
	Base64. The string contains a signcrypt element. It SHOULD also be
	encrypted to self.</p>
	<example caption='The signcrypt extension.'><![CDATA[
<signcrypt to='user@example.org' timestamp='TODO XEP-82 timestamp'>
  <body>
    Secret Message
  </body>
</signcrypt>]]></example>
	<p>The signcrypt element must posses at least one 'to' and exaclty
	one 'timestamp' attribute. The 'to' element(s) MUST contain the
	intended recipient's XMPP address of the signed and encrypted data
	to prevent Surreptitous Forward Attacks. The XMPP address found in
	the 'to' attribute SHOULD be without Resourcepart (i.e. a bare
	JID). The 'timestamp' attribute contains the timestamp when the
	signcrypt element was signed and encrypted. Recipients MUST verify
	the values of these two elements for plausability</p>
	<p>Child elements of signcryt can be anything. This specification
	only defines the body element qualified by the urn:xmpp:openpgp:0
	namespace, which is the same element as RFC 6121 5.2.3 but only in
	a different namespace. Furthermore recipients MUST verify if the
	signature corresponds to the sending XMPP address's by using the
	information found in the PEP node as described above.</p>
  </section2>
  <section2 topic='Synchronizing the private key' anchor='synchro'>
	<p>To allow new XMPP clients to easily retrieve (and eventually
	update) the private key, Private Data Storage is used as
	synchronization mechanism. The private key MUST be a OpenPGP
	symetric encrypted packet with a backup code (e.g.:
	https://github.com/open-keychain/open-keychain/wiki/Backups)</p>
	<p>TODO Examples</p>
  </section2>
</section1>
<section1 topic='Rationale' anchor='rationale'>
  <p>This specificaiton leaves it open if the used OpenPGP key should
  be a primary key or a subkey. It's even possible to announce
  multiple public keys in the PEP node. Implementations MUST be
  prepared to find multiple public keys. The authors however believe
  that for ease of use only one OpenPGP key specially craftet for the
  XMPP uses case should be created.</p>
  <p>The openpgp and signcrypt elements add as container for arbitrary
  data and can thus act as building block for encrypting data for
  Message, IQ and Presence stanzas.</p>
  <section2 topic='Addressing the issues and problems of XEP-0027' anchor='solving-xep0027-issues'>
	<p>This specification addresses all relevant issues of
	XEP-0027. It prevents reply attacks my including the recipient(s)
	and a timestamp in the signcrypt element. It allows for both,
	signing and encrypting of the signcrypt element. On the other
	hand, the scope of the specification was intentionally limited to
	OpenPGP only.</p>
	<p>Features like signed presences, which is provided by XEP-0027,
	may be added later on as add-on XEP to this.</p>
  </section2>
</section1>
<section1 topic='Implementation Notes' anchor='impl'>
  <p>OPTIONAL.</p>
</section1>
<section1 topic='Accessibility Considerations' anchor='access'>
  <p>OPTIONAL.</p>
</section1>
<section1 topic='Internationalization Considerations' anchor='i18n'>
  <p>OPTIONAL.</p>
</section1>
<section1 topic='Security Considerations' anchor='security'>
  <p>REQUIRED.</p>
</section1>
<section1 topic='IANA Considerations' anchor='iana'>
  <p>REQUIRED.</p>
</section1>
<section1 topic='XMPP Registrar Considerations' anchor='registrar'>
  <p>REQUIRED.</p>
</section1>
<section1 topic='XML Schema' anchor='schema'>
  <p>REQUIRED for protocol specifications.</p>
</section1>
<section1 topic='Acknowledgements' anchor='acknowledgements'>
  <p>The first draft of this specification was worked out and written
  on the wall of the 'Kymera' room in one of Google's buildings by the
  authors, consisting of members of the XMPP Standards Foundation and
  the OpenKeychain project, at the GSOC Mentors Summit 2015. The
  authors would like to thank Google for making it possible by
  bringing the right people together.</p>
</section1>
</xep>
